#!/usr/bin/sh
#
# DESCRIPTION
#   Rotate between dark and light theme in a i3-window
#   environment, switching also shell theme using base16
#   scripts. Meant to be run on a cron job schedule based
#   on desired time of the day.
#
#================================================================
# IMPLEMENTATION
#   version         1.0.0
#   author          Andrea Giacomo Baldan
#   copyright       Copyright (c) Andrea Giacomo Baldan
#   license         GNU General Public License
#
#===============================================================
# REQUIREMENTS
#   i3-wm
#   base16_shell
#   base16_themes for vim

# env
readonly HOME="/home/codep"
readonly DWALLPAPER="Pictures/blue.jpg"
readonly LWALLPAPER="Pictures/light.jpg"
readonly LTHEME=solarized-light
readonly DTHEME=oceanicnext
readonly VLTHEME=base16-solarized-light  # vim solarized as light theme
readonly VDTHEME=nord       # vim nord as dark theme

# time - winter settings
readonly MORNING="08:30"
readonly EVENING="16:30"

# light colors
readonly LBACKGROUND="#e0e0e0"
readonly LSTATUSLINE="#3f4f5f"
readonly LINACTIVEWS="#e0e0e0 #e0e0e0 #3f4f5f"
readonly LFOCUSEDWS="#e0e0e0 #bfbfbf #3f4f5f"
# dark colors
readonly DBACKGROUND="#1B2B34"
readonly DSTATUSLINE="#DCDCDC"
readonly DINACTIVEWS="#1B2B34 #1B2B34 #DCDCDC"


# set base16 theme and overwrite ENV variable and vimrc_background
set_theme() {
    local script=$1
    local theme=$2
    local scheme=$3
    [ -f $script ] && . $script
    ln -fs $script ~/.base16_theme
    export BASE16_THEME=${theme}
    # BUG: if colorscheme is solarized change also Search bg color
    echo "colorscheme $scheme" > ~/.vimrc_background
    if [[ $scheme == base16-solarized-light ]]; then
        echo "hi Search ctermbg=18" >> ~/.vimrc_background
    else
        echo "\" hi Search ctermbg=18" >> ~/.vimrc_background
    fi
}


if [[ "$1" == "light" ]]; then
    feh --bg-scale "$HOME/$LWALLPAPER"
    # comment dark colors
    sed -i "s/^\s*background $DBACKGROUND/\t\t\t# background $DBACKGROUND/" ~/.config/i3/config
    sed -i "s/^\s*statusline $DSTATUSLINE/\t\t\t# statusline $DSTATUSLINE/" ~/.config/i3/config
    sed -i "s/^\s*inactive_workspace $DINACTIVEWS/\t\t\t# inactive_workspace $DINACTIVEWS/" ~/.config/i3/config
    # uncomment light colors
    sed -i "s/^\s*# background $LBACKGROUND/\t\t\tbackground $LBACKGROUND/" ~/.config/i3/config
    sed -i "s/^\s*# statusline $LSTATUSLINE/\t\t\tstatusline $LSTATUSLINE/" ~/.config/i3/config
    sed -i "s/^\s*# inactive_workspace $LINACTIVEWS/\t\t\tinactive_workspace $LINACTIVEWS/" ~/.config/i3/config
    sed -i "s/^\s*# focused_workspace $LFOCUSEDWS/\t\t\tfocused_workspace $LFOCUSEDWS/" ~/.config/i3/config
    set_theme "$HOME/.config/base16-shell/scripts/base16-$LTHEME.sh" $LTHEME $VLTHEME
    i3-msg reload
else
    # else if time >= 17:30 and <= 08:29 set dark theme
    feh --bg-scale "$HOME/$DWALLPAPER"
    # comment light colors
    sed -i "s/^\s*background $LBACKGROUND/\t\t\t# background $LBACKGROUND/" ~/.config/i3/config
    sed -i "s/^\s*statusline $LSTATUSLINE/\t\t\t# statusline $LSTATUSLINE/" ~/.config/i3/config
    sed -i "s/^\s*inactive_workspace $LINACTIVEWS/\t\t\t# inactive_workspace $LINACTIVEWS/" ~/.config/i3/config
    sed -i "s/^\s*focused_workspace $LFOCUSEDWS/\t\t\t# focused_workspace $LFOCUSEDWS/" ~/.config/i3/config
    # uncomment dark colors
    sed -i "s/^\s*# background $DBACKGROUND/\t\t\tbackground $DBACKGROUND/" ~/.config/i3/config
    sed -i "s/^\s*# statusline $DSTATUSLINE/\t\t\tstatusline $DSTATUSLINE/" ~/.config/i3/config
    sed -i "s/^\s*# inactive_workspace $DINACTIVEWS/\t\t\tinactive_workspace $DINACTIVEWS/" ~/.config/i3/config
    set_theme "$HOME/.config/base16-shell/scripts/base16-$DTHEME.sh" $DTHEME $VDTHEME
    i3-msg reload
fi

# End when we log out and no X screen is available.
if [ $? -ne 0 ]; then
    echo "Feh Error, exiting."
    exit
fi
